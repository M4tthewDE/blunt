package components

import "fmt"

type GraphElement struct {
	Id int64
	ImagePath string
}

func subGraphPath(graphElement GraphElement, subGraphType string) string {
	return fmt.Sprintf("/subGraph/%s/%d", subGraphType, graphElement.Id)
}

func subGraphId(subGraphType string, id int64) string {
	return fmt.Sprintf("subgraph-%s-%d", subGraphType, id)
}

templ CastMemberGraph(parent GraphElement, graph []GraphElement, graphType, subGraphType string) {
	<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
	<script>
		htmx.on("htmx:beforeRequest", function(evt) {
			let target = evt.detail.target;

			if (target.children.length != 0) {
				while (target.firstChild) {
					target.removeChild(target.firstChild);
				}

				evt.preventDefault();
			}
		});
	</script>
	<html>
		<div style="margin: auto; width: 50%; display: grid; align-items: start; justify-items: center;">
			<img src={ parent.ImagePath } width="90" height="135" style="padding-bottom: 1rem;"></img>
			@CastMemberSubGraph(graph, graphType, subGraphType, parent.Id)
		</div>
	</html>
}

templ CastMemberSubGraph(graph []GraphElement, graphType, subGraphType string, id int64) {
	<div style="display: flex; justify-items: center;" id={ subGraphId(graphType, id) }>
		for _, child := range graph {
			<div>
				<div style="display: flex; justify-content: center; padding-bottom: 1rem;">
					<button
						hx-post={ subGraphPath(child, subGraphType) }
						hx-trigger="click"
						hx-target={ fmt.Sprintf("#%s", subGraphId(subGraphType, child.Id)) }
						hx-swap="outerHTML"
					>
						<img src={ child.ImagePath } width="90" height="135"></img>
					</button>
				</div>
				<div id={ subGraphId(subGraphType, child.Id) }></div>
			</div>
		}
	</div>
}
